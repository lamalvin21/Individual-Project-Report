\chapter{Implementation}
This chapter will detail the implementation phase of the project and how the solution was reached using the design section and following the specification. 

\section{Command Line Command}
\hspace*{0.5cm} Before starting implementation, familiarisation of command line commands is necessary to understand in order to commence implementation. Since the executable .jar file enables anyone to use SPARQL-Anything, starting the command with the execution of the .jar file is needed. For example:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    java -jar sparql-anything-0.8.0.jar 
\end{lstlisting}

\noindent Then, expand it to specify the file that contains the query and note the file path. For example:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    -q filepath/filename.sparql
\end{lstlisting}

\noindent Because the project involves generating a knowledge graph of the user's choice, passing a parameter into the query is vital. It can be done as follows: 

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    --values variable=variablevalue
\end{lstlisting}

\noindent The assigned variable can be used in the SPARQL query by specifying the variable name and adding a question mark and underscore at the front. So passing the parameter 'variable', following the previous example, can be accessed through:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    ?_variable
\end{lstlisting}

\noindent If necessary, the resulting knowledge graph can be output into a file given a location. For example:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    --output filepath/outputfile.ttl
\end{lstlisting}

\noindent Altogether, the command will look like this:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    java -jar sparql-anything-0.8.0.jar
    -q filepath/filename.sparql 
    --values variable=variablevalue 
    --output filepath/outputfile.ttl
\end{lstlisting}

\noindent In English, this command states: \\
\hspace*{0.5cm} "Using the executable file sparql-anything-0.8.0.jar, execute the query in filename.sparql from the filepath folder and pass in \textit{variable} into the query with value variablevalue and output the knowledge graph in outputfile.ttl from the same file location". 

\section{Prefixes}
\hspace*{0.5cm} The prefixes in the ontology are mainly used in the relationship part of the triples. Below are the PREFIX that will be used:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX fx:   <http://sparql.xyz/facade-x/ns/>
    PREFIX xyz:  <http://sparql.xyz/facade-x/data/>
    PREFIX oont: <http://w3id.org/polifonia/ontology/organs/>
    PREFIX wd: <https://www.wikidata.org/wiki/> 
\end{lstlisting}

\section{Ontology Reconstruction}
\hspace*{0.5cm} As mentioned in the design, scope of the provided ontology was too broad for the envisioned knowledge graph. Therefore, refinement of the provided ontology and exploration with external links was necessary to produce a relevant ontology. In the following subsections, the process of creating the ontology using the dataset and external data will be detailed. This ontology will be input into the CONSTRUCT segment of the query which acts as the framework for the knowledge graph as mentioned in the Context chapter. 

\subsection{Dataset Ontology}
\hspace*{0.5cm} Using \textit{Figure 7.1}, identification and grouping of relevant data was done and can now be expanded upon. 

\subsubsection{Organ}
\hspace*{0.5cm} After selecting the most relevant information to an organ from each of the .json files that stores the data, it was attached to the organ node. Using the provided ontology to identify data relevant to the organ node was used as well to ensure the correct relationships were stated. Relevant data and relationship to the organ are listed below:

\vspace{-0.1cm}
\begin{itemize}
    \itemsep0em 
    \item \textit{technicals} - xyz:technicals
    \item \textit{disposition} - xyz:disposition
    \item \textit{change} - xyz:change
    \item builder - oont:builder
    \item originalLocation - oont:consolelocation
    \item dateOfBirth - oont:dateOfBirth
    \item building - oont:monument
    \item monumentNumber - oont:monumentNumber
    \item organName - oont:name
    \item organNumber - oont:organNumber 
    \item state - oont:state 
    \item particularity - oont:particularities
    \item history - oont:history
    \item creator - oont:creator
    \item moreInformation - oont:moreInformation 
\end{itemize}

This data is directly relevant to the organ as illustrated in the provided organ ontology. Data such as originalLocation, dateOfbirth and state were added as they were part of the dataset and relevant to the organ. Because technicals, disposition and change were identified as nodes for further expansion, they were also connected to the main organ node. 

The relationships used to describe the relation between the organ and it's objects were provided and usually had intuitive names based on the object. 

\subsubsection{Technicals}
\hspace*{0.5cm} This branch of technical data regarding an organ was mainly derived off one .json file and a section of the provided ontology that referred to it's 'parthood'. All relationships branching from this 'technicals' node were provided. Relevant data and relationships identified are below:

\vspace{-0.1cm}
\begin{itemize}
    \itemsep0em 
    \item systemPlayingAids - oont:systemPlayingAids
    \vspace{-0.05cm}
    \item pitch - oont:pitch
    \vspace{-0.05cm}
    \item range1 -  oont:keyboardRange
    \vspace{-0.05cm}
    \item range2 - oont:pedalRange
    \vspace{-0.05cm}
    \item temperature - oont:temperature
    \vspace{-0.05cm}
    \item windPressure - oont:windPressure
    \vspace{-0.05cm}
    \item windSystem - oont:windSystem
\end{itemize}

\textit{range1} and \textit{range2} corresponded to ranges of the keyboard and pedal respectively so their relationship noted it as such. 

\subsubsection{Disposition}
\hspace*{0.5cm} This branch of data referred to qualities of the selected organ. The provided ontology covered this section but had nodes that did not appear in the dataset so needed to be adjusted. Relationships were also provided. The readjustment of the ontology would include:

\vspace{-0.1cm}
\begin{itemize}
    \itemsep0em 
    \item divisionName - xyz:divisionName
    \vspace{-0.05cm}
    \item partition - oont:partition
    \vspace{-0.05cm}
    \item specification - oont:AdditionalSpecification
\end{itemize}

\subsubsection{Change}
\hspace*{0.5cm} This branch stated changes made to the organ during it's lifetime. The provided ontology did not mention changes of a given organ so it was added to represent it in the knowledge graph. Relationships used were provided. The new section added to the ontology were:

\vspace{-0.1cm}
\begin{itemize}
    \itemsep0em 
    \vspace{-0.15cm}
    \item dateChange - oont:date 
    \vspace{-0.05cm}
    \item description - oont:AdditionalSpecification
    \vspace{-0.05cm}
    \item maintainer - oont:Builder
    \vspace{-0.1cm}
\end{itemize}

\subsection{External Ontology}
\hspace*{0.5cm} The method in which external data will be added to the knowledge graph will involve following the flow in \textit{Figure 7.2}.

\subsubsection{External Data Sources}
\hspace*{0.5cm} As mentioned in the \textit{specification} section, Wikidata and MusicBrainz can be used to expand the existing knowledge graph. Following \textit{Figure 7.1}, a node branching out of the main organ node was made to represent Wikidata's organ page \cite{organwikidata} from which the same structure was employed. The relationships used were the same as those on Wikidata. Data branching off the organWikidata node with their corresponding relationship were:

\vspace{-0.15cm}
\begin{itemize}
    \itemsep0em 
    \item keyboardInstrument - wd:Property:P279
    \item buildingComponent - wd:Property:P279
    \item organology - wd:Property:P2579 
    \item westernClassicalMusic - wd:Property:P366
    \item musicTradition - wd:Property:P366
    \item organExpert - wd:Property:P3095
    \item organist - wd:Property:P1535
    \item catholicEncyclopedia - wd:Property:P1343
    \item metropolitanMuseumOfArtTaggingVocabulary - wd:Property:P1343
    \item dbpedia - wd:Property:P1709
    \item organCase - wd:Property:P527
    \item organPipe - wd:Property:P527
    \item musicalKeyboard - wd:Property:P527
    \item pedalKeyboard - wd:Property:P527
    \item organStop - wd:Property:P527
    \item organConsole - wd:Property:P527
    \item swellBox - wd:Property:P527
    \item pipeOrgan - wd:Property:P1889
\end{itemize}

External data from MusicBrainz's organ page \cite{organmusicbrainz} was not as vast but extended the knowledge graph in a different way to Wikidata with overlapping data being connected. Expanding from the main organ node using relationships defined on MusicBrainz, provided more context with relationships mirroring that of MusicBrainz as well. This can be seen below:

\vspace{-0.15cm}
\begin{itemize}
    \itemsep0em 
    \item barrelOrgan - rdfs:subclassOf
    \item electricOrgan - rdfs:subclassOf
    \item pipeOrgan - rdfs:subclassOf
    \begin{itemize}
        \itemsep0em 
        \vspace{-0.15cm}
        \item pipeOrganInfo - oont:extraInformation
        \vspace{-0.15cm}
    \end{itemize}
    \item reedOrgan - rdfs:subclassOf
    \begin{itemize}
        \itemsep0em 
        \vspace{-0.15cm}
        \item reedOrganImage - oont:locationImage
        \vspace{-0.15cm}
    \end{itemize}
    \item windInstrument - rdf:type
    \item organWikidata - oont:extraInformation
\end{itemize}

\subsubsection{Custom Links}
\hspace*{0.5cm} These links used data from the dataset to form custom links, via string manipulation, as points of expansion. Identifying data from the dataset that was able to be expanded upon was difficult as data was very specific to the organ and external links found online were too broad. However, data in the dataset that was more general such as locations could be expanded upon. Some points of expansion are:

\vspace{-0.15cm}
\begin{itemize}
    \itemsep0em 
    \vspace{-0.05cm}
    \item buildinginfo
    \vspace{-0.05cm}
    \item stateinfo
    \vspace{-0.05cm}
    \item maintainerinfo
    \vspace{-0.05cm}
\end{itemize}
\vspace{-0.1cm}

\noindent The relationship for all additional nodes is "oont:extraInformation".

\subsubsection{Generic Links}
\hspace*{0.5cm} These links are not organ-specific but provide more detail and general information regarding some aspects of the knowledge graph. The data in the dataset being so specific hinders the amount of external generic links that can be added, nevertheless, there are some points of expansion such as:

\vspace{-0.15cm}
\begin{itemize}
    \itemsep0em 
    \vspace{-0.05cm}
    \item pitchinfo
    \vspace{-0.05cm}
    \item windPressureInfo
    \vspace{-0.05cm}
    \item divisionInfo
    \vspace{-0.1cm}
\end{itemize}
\vspace{-0.1cm}

\noindent The relationship for all additional nodes is "oont:extraInformation".

\subsection{Final Ontology}
\hspace*{0.5cm} Combining both dataset and external ontologies forms one ontology can be seen in RDF. This ontology can be placed in the CONSTRUCT section of the query.

\section{Knowledge Graph Generation}
\hspace*{0.5cm} The process of creating the knowledge graph generation query for the ontology will be detailed below:

\subsection{Dataset Knowledge Graph Query}
\hspace*{0.5cm} This subsection will detail the process for creating the query that is responsible for extracting data from the dataset using \textit{Figure 7.2} and query skeleton structure in the design section. All code in this section will be part of the WHERE clause of the query. Below is an example of data abstraction from a .json file:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    SERVICE <x-sparql-anything:file:./output/history_base.json> 
    {
    BIND(CONCAT("$.", ?_organ, ".originallocation") AS ?organOriginalLocation) .

    fx:properties
        fx:json.path.1 ?organOriginalLocation ; .

    [] a fx:root; 
        rdf:_1 ?originalLocation ;
    } 
\end{lstlisting}

The snippet above follows \textit{Figure 7.2} and is the same structure of most SPARQL-Anything SERVICE calls in the query. 

\begin{enumerate}
    \item SERVICE call queries the \textit{history\_base.json} file in the \textit{output} folder using SPARQL-Anything. 
    \item BIND creates the JSON path using the parameter \textit{?\_organ} which is passed in through the command line, so the correct data can be found for the right organ. 
    \item \textit{fx:properties} then locates the data, which is assigned to the variable \textit{?originalLocation}. 
    \item ?originalLocation is used and data found is added to the knowledge graph.
\end{enumerate}

This SPARQL-Anything call is followed by many other SPARQL-Anything calls to complete the knowledge graph. Although not explicitly stated in the design, the passed in organ \textit{?\_organ} is bound to the ontology variable \textit{?organ} in the first SPARQL-Anything call as seen below:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    BIND (?_organ AS ?organ) .
\end{lstlisting}

\subsection{External Knowledge Graph Query}
\hspace*{0.5cm} This subsection will describe the process in which external data was added to the knowledge graph and how it was implemented in the query. 

\subsubsection{Custom Data}
\hspace*{0.5cm} For links that required data from the dataset, the query skeleton structure and \textit{Figure 7.2} was followed providing the framework to create the query. Custom links were created from Wikipedia as it was one of the few websites that covered the scope of what could be added. It also gave adequate extra information for the data and sufficiently extended breadth of the resulting knowledge graph. To match the context of the dataset, the link created was from the Dutch version of Wikipedia. As mentioned in the ontology creation section, custom links were difficult to identify using the dataset as data was very specific to a particular organ. An example of a custom link addition can be seen below:

\lstset
{
    breaklines=true,
    breakatwhitespace=false,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    SERVICE <x-sparql-anything:file:./output/base.json>
    {
        BIND(CONCAT("$.", ?_organ, ".building") AS ?organBuilding) .
    
        fx:properties
            fx:json.path.1 ?organBuilding ; .
    
        [] a fx:root; 
            rdf:_1 ?building ;
    
        BIND(IRI(REPLACE(CONCAT("https://nl.wikipedia.org/wiki/", ?building), " ", "_")) AS ?buildingInfo) . 
    } 
\end{lstlisting}

The snippet above also follows \textit{Figure 7.2} and is used whenever a custom external link is added to the knowledge graph. The beginning of the query follows the same format as the dataset knowledge graph query but has an extra line at the end.

Using string manipulation and other SPARQL functions, the custom link is created as follows:
\begin{enumerate}
    \item \textbf{CONCAT} combines the building name retrieved from the dataset (stored in the \textit{?\_building} variable) with a generic Dutch Wikipedia link.
    \item \textbf{REPLACE} removes spaces in the \textit{?\_building} variable (if any) and replaces them with underscores to create a valid link. 
    \item \textbf{IRI} takes this new string and converts it into a URI.
    \item \textbf{BIND} takes this newly created link and assigns it to the variable \textit{?buildingInfo} to be added to the knowledge graph. 
\end{enumerate}

This is an example of where SPARQL-Anything's Facade-X approach is useful because  features of SPARQL within a SPARQL-Anything query can be used without having to learn something completely new. 

\subsubsection{General Data}
\hspace*{0.5cm} For links that were independent of the dataset, they were added after the SPARQL-Anything calls to stay consistent with \textit{Figure 7.2}. For links personally identified, they were added with the corresponding node which they expanded upon. These specific links were found for data that had a broad scope, so websites regarding those subjects could be found. For example:

\lstset
{
    breaklines=true,
    breakatwhitespace=false,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
SERVICE <x-sparql-anything:file:./output/tech.json>
{
    BIND(CONCAT("$.", ?_organ, ".pitch") AS ?organPitch) .

    fx:properties
        fx:json.path.1 ?organPitch ; .

    [] a fx:root; 
        rdf:_1 ?pitch ;
    
    BIND(URI("https://organhistoricalsociety.org/OrganHistory/works/works04.htm") AS ?pitchInfo) .
} 
\end{lstlisting}

This snippet follows the same structure as most SPARQL-Anything calls, but the last line binds the URI to \textit{?pitchInfo}. This website, in particular, found more information describing the pitch of an organ. 

External data regarding MusicBrainz and Wikidata were added by following the format on the website and bound to a variable in the ontology. Most data on the website used links from Wikidata so the PREFIX \textit{wd} (for Wikidata was used), but some data contained explicit links. For example:

\lstset
{
    breaklines=true,
    breakatwhitespace=true,
    basicstyle=\ttfamily,
}
\begin{lstlisting}
    BIND(wd:Q752638 AS ?barrelOrgan) . 
    BIND(IRI("https://dbpedia.org/ontology/Organ") AS ?dbpedia) .
\end{lstlisting}

\subsection{Final Knowledge Graph Query}
\hspace*{0.5cm} The final query to generate the knowledge graph involves: 

\begin{enumerate}
    \item CONSTRUCT: Ontology
    \item WHERE:
    \begin{enumerate}
        \vspace{-0.25cm}
        \item SERVICE: call to SPARQL-Anything
        \item External Data
    \end{enumerate}
\end{enumerate}
